#!/bin/bash

CP_USER="cpr_keyapi"

case "$1" in
    "configure")
        grep -q "^$CP_USER:" /etc/passwd || ( \
            adduser --gecos 'CardProxy.KeyAPI' --disabled-password $CP_USER ; \
            mkdir -p /var/run/$CP_USER /var/log/$CP_USER ; \
            chown $CP_USER:root /var/log/$CP_USER /var/run/$CP_USER )

        ln -s ../sites-available/10-card_proxy_keyapi /etc/nginx/sites-enabled
        service nginx restart
        service card_proxy_keyapi restart

        update-rc.d card_proxy_keyapi defaults
        ;;

    "upgrade" | "abort-upgrade" | "abort-remove" | "abort-deconfigure")

        service card_proxy_keyapi restart

        ;;

    *) 
        echo "postinst called with unknown argument '$1'" >&2
        exit 1
        ;;
esac

exit 0

